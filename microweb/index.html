<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>智能网关配置</title>
    <link rel="stylesheet" href="jquery-ui.css">
<style>
  .ui-progressbar {
    position: relative;
  }
  .progress-label {
    position: absolute;
    left: 30%;
    top: 2px;
    font-weight: bold;
    text-shadow: 1px 1px 0 #fff;
  }
  </style>
  <script>


  </script>
</head>

    <body>

<div id="accordion">
  <h3>基本信息</h3>
  <div>
    <p>
    <h4>当前设备编号：<label id="message"></label></h4>
    </p>
      <input type="text" id="ssid" name="ssid"  placeholder="输入WiFI的SSID">
    <br/>
      <input type="text" id="wifipassword" name="wifipassword"  placeholder="输入WiFI密码">
    <br/>
      <input type="button" value="测试" onclick="operate_wifi('connect')"> &nbsp;&nbsp;&nbsp;&nbsp;
      <input type="button" onclick="operate_wifi('save')" value="保存">

      <input type="checkbox" id="check22"><label for="check22">多选框</label>
    <p>
      <div id="progressbar">
          <div class="progress-label">.</div>
     </div>
    </p>
  </div>
  <h3>MODBUS RTU配置</h3>
  <div >
    <p>

              <label for="baundrate">波特率:</label>
                <select id="baundrate" name="baundrate">

                      <option>9600</option>
                      <option>19200</option>
                      <option>18400</option>
                      <option>57600</option>
                      <option selected>115200</option>

                </select>
       </p>

      <div id="toolbar" class="ui-widget-header ui-corner-all">
          <input type="checkbox"  id="shuffle"><label for="shuffle">数据位：8</label>
           <input type="checkbox" id="shuffle2"><label for="shuffle2">停止位：1</label>
          <input type="checkbox" id="shuffle3"><label for="shuffle3">校验：无</label>
          <br>
          <input  type="text" id="rtu_slaveaddr" name="rtu_slaveaddr"  placeholder="从站地址(ID)">
          <input  type="text" id="rtu_startaddr" name="rtu_startaddr"  placeholder="寄存器地址">
          <input  type="text" id="rtu_readquantity" name="rtu_readquantity"  placeholder="读取数量">
      </div>

     <span id="check">


           <input type="radio" id="fr03" name="project">
          <label for="fr03">读保持寄存器(03)</label>

           <input type="radio" id="fr02" name="project">
          <label for="fr02">读离散输入(02)</label>
     </span>
     <br/>
              <input type="button" value="测试" onclick="operate_modbus_rtu('connect')"> &nbsp;&nbsp;&nbsp;&nbsp;
              <input type="button" onclick="operate_modbus_rtu('save')" value="保存">
            <p>
              <div id="progressbar3">
                  <div align="center" class="progress-label">.</div>
             </div>
            </p>
  </div>

    <h3>MODBUS TCP配置</h3>
  <div >

              <input align="left"  type="text" id="slaveip" name="slaveip"  placeholder="输入从站的ip">
               <input  type="text" id="slaveport" name="slaveport"  placeholder="端口号">
              <input  type="text" id="slaveaddr" name="slaveaddr"  placeholder="从站地址(ID)">
              <input  type="text" id="startaddr" name="startaddr"  placeholder="寄存器地址">
               <input  type="text" id="readquantity" name="readquantity"  placeholder="读取数量">

     <span id="check2">


           <input type="radio" id="ft03"  name="project">
          <label for="ft03">功能码03</label>

           <input type="radio" id="ft02" value="ft02" name="project">
          <label for="ft02">功能码02</label>
     </span>
    <br/>
              <input type="button" value="测试" onclick="operate_modbus('connect')"> &nbsp;&nbsp;&nbsp;&nbsp;
              <input type="button" onclick="operate_modbus('save')" value="保存">
            <p>
              <div id="progressbar2">
                  <div align="center" class="progress-label">.</div>
             </div>
            </p>
  </div>


  <h3>LoRa配置</h3>
  <div>
    <p>
    Nam enim risus, molestie et, porta ac, aliquam ac, risus. Quisque lobortis.
    Phasellus pellentesque purus in massa. Aenean in pede. Phasellus ac libero
    ac tellus pellentesque semper. Sed ac felis. Sed commodo, magna quis
    lacinia ornare, quam ante aliquam nisi, eu iaculis leo purus venenatis dui.
    </p>
    <ul>
      <li>List item one</li>
      <li>List item two</li>
      <li>List item three</li>
    </ul>
  </div>
  <h3>MQTT配置</h3>
  <div>
    <p>
    Cras dictum. Pellentesque habitant morbi tristique senectus et netus
    et malesuada fames ac turpis egestas. Vestibulum ante ipsum primis in
    faucibus orci luctus et ultrices posuere cubilia Curae; Aenean lacinia
    mauris vel est.
    </p>
    <p>
    Suspendisse eu nisl. Nullam ut libero. Integer dignissim consequat lectus.
    Class aptent taciti sociosqu ad litora torquent per conubia nostra, per
    inceptos himenaeos.
    </p>
  </div>
</div>
    <script src="jquery-3.5.1.min.js"></script>
    <script src="jquery-ui.min.js"></script>
<script>

$(function(){
    $( "#accordion" ).accordion();
    $( "button, input, a" ).button();
    $( "select" ).selectmenu();
    $( "#check" ).buttonset();
    $( "#check2" ).buttonset();
    $( "#check22" ).button();
    $( "#shuffle" ).button();
    $( "#shuffle2" ).button();
    $( "#shuffle3" ).button();

    //$("#ft02").attr("checked","checked");
    onLoad();

   });

function getCookie(name) {
        var value = "; " + document.cookie;
        //alert(value);
        var parts = value.split("; " + name + "=");
        //alert(parts);
        if (parts.length == 2)
            //alert(parts.pop().split(";").shift());
            return parts.pop().split(";").shift();
        }
function showMessage() {
       alert(getCookie('user_cookies')+' ssid,'+getCookie('ssid_c'));
       document.getElementById('message').innerHTML = getCookie('machine_cookies');
       $("#ssid").val(getCookie('ssid_c'));
       $("#wifipassword").val(getCookie('wifi_c'));
}
function onLoad() {
       showMessage();
}


 function operate_wifi(p)
{
  var progressbar = $( "#progressbar" ),
      progressLabel = $( ".progress-label" );
      $( "#progressbar" ).progressbar({
      value: false
    });
    progressLabel.text("处理中.......");

    var ssid=$('#ssid').val();
    var wifipassword=$('#wifipassword').val();
    var json_data = JSON.stringify({
             'ssid': ssid,
             'wifipassword': wifipassword
           });

     alert(json_data);

     if (p == 'connect')
     {
         $.ajax({
               type:"post",//请求方式
               url:"/post/connect/wifi",//发送请求地址
               timeout:20000,//超时时间：20秒
               data:json_data,
               dataType:"html",//设置返回数据的格式
               //请求成功后的回调函数 data为html格式
               success:function(res){
                   alert('success'+res);
                   obj = JSON.parse(res);
                   //JSON.stringify(); //JavaScript 值转换为 JSON 字符串
                   if (obj['connected']=='True')
                   {
                        progressbar.progressbar({
                             value: true,
                        });
                      progressLabel.text("连接成功,请保存！");
                   }
                   else
                   {
                     progressbar.progressbar({
                             value: true,
                        });
                      progressLabel.text("连接失败,重试一下吧！");
                   }

              },
              //请求出错的处理
              error:function(){
                 progressbar.progressbar({
                             value: true,
                        });
                 progressLabel.text("出错了，请重试....！");;
              }
           });
     }

     if (p == 'save')
     {
         $.ajax({
               type:"post",//请求方式
               url:"/post/save/wifi",//发送请求地址
               timeout:20000,//超时时间：20秒
               data:json_data,
               dataType:"html",//设置返回数据的格式
               //请求成功后的回调函数 data为html格式
               success:function(res){
                   alert('success'+res);
                   obj = JSON.parse(res);
                   //JSON.stringify(); //JavaScript 值转换为 JSON 字符串
                   if (obj['connected']=='True')
                   {
                        progressbar.progressbar({
                             value: true,
                        });
                      progressLabel.text("保存成功！");
                   }
                   else
                   {
                     progressbar.progressbar({
                             value: true,
                        });
                      progressLabel.text("保存失败,重试一下吧！");
                   }

              },
              //请求出错的处理
              error:function(){
                 progressbar.progressbar({
                             value: true,
                        });
                 progressLabel.text("出错了，请重试....！");;
              }
           });
     }

}

function operate_modbus(p)
{
  var progressbar = $( "#progressbar2" ),
      progressLabel = $( ".progress-label" );
      $( "#progressbar2" ).progressbar({
      value: false
    });
    progressLabel.text("处理中.......");
    alert($('#ft03').is(':checked'));

    //alert($("#ft03").get(0).checked);


    var json_data = JSON.stringify({
             'slaveip': $('#slaveip').val(),
             'slaveport': $('#slaveport').val(),
             'slaveaddr': $('#slaveaddr').val(),
             'startaddr': $('#startaddr').val(),
             'readquantity': $('#readquantity').val(),
             'ft03': $('#ft03').is(':checked'),
             'ft02': $('#ft02').is(':checked')
           });

     alert(json_data);

     if (p == 'connect')
     {
         $.ajax({
               type:"post",//请求方式
               url:"/post/connect/modbus",//发送请求地址
               timeout:5000,//超时时间：5秒
               data:json_data,
               dataType:"html",//设置返回数据的格式
               //请求成功后的回调函数 data为html格式
               success:function(res){
                   alert('success'+res);
                   obj = JSON.parse(res);
                   //JSON.stringify(); //JavaScript 值转换为 JSON 字符串
                   if (obj['connected']=='True')
                   {
                        progressbar.progressbar({
                             value: true,
                        });
                      progressLabel.text("成功:"+obj['data']);
                   }
                   else
                   {
                     progressbar.progressbar({
                             value: true,
                        });
                      progressLabel.text("读取失败,重试一下吧！");
                   }

              },
              //请求出错的处理
              error:function(){
                 progressbar.progressbar({
                             value: true,
                        });
                 progressLabel.text("出错了，请重试....！");;
              }
           });
     }

     if (p == 'save')
     {
         $.ajax({
               type:"post",//请求方式
               url:"/post/save/wifi",//发送请求地址
               timeout:20000,//超时时间：20秒
               data:json_data,
               dataType:"html",//设置返回数据的格式
               //请求成功后的回调函数 data为html格式
               success:function(res){
                   alert('success'+res);
                   obj = JSON.parse(res);
                   //JSON.stringify(); //JavaScript 值转换为 JSON 字符串
                   if (obj['connected']=='True')
                   {
                        progressbar.progressbar({
                             value: true,
                        });
                      progressLabel.text("保存成功！");
                   }
                   else
                   {
                     progressbar.progressbar({
                             value: true,
                        });
                      progressLabel.text("保存失败,重试一下吧！");
                   }

              },
              //请求出错的处理
              error:function(){
                 progressbar.progressbar({
                             value: true,
                        });
                 progressLabel.text("出错了，请重试....！");;
              }
           });
     }

}

function operate_modbus_rtu(p)
{
  var progressbar = $( "#progressbar3" ),
      progressLabel = $( ".progress-label" );
      $( "#progressbar3" ).progressbar({
      value: false
    });
    progressLabel.text("处理中.......");
    alert($('#fr03').is(':checked'));

    //alert($("#ft03").get(0).checked);


    var json_data = JSON.stringify({
             'baundrate': $('#baundrate').val(),
             'rtu_slaveaddr': $('#rtu_slaveaddr').val(),
             'rtu_startaddr': $('#rtu_startaddr').val(),
             'rtu_readquantity': $('#rtu_readquantity').val(),
             'fr03': $('#fr03').is(':checked'),
             'fr02': $('#fr02').is(':checked')
           });

     alert(json_data);

     if (p == 'connect')
     {
         $.ajax({
               type:"post",//请求方式
               url:"/post/connect/modbus_rtu",//发送请求地址
               timeout:5000,//超时时间：5秒
               data:json_data,
               dataType:"html",//设置返回数据的格式
               //请求成功后的回调函数 data为html格式
               success:function(res){
                   alert('success'+res);
                   obj = JSON.parse(res);
                   //JSON.stringify(); //JavaScript 值转换为 JSON 字符串
                   if (obj['connected']=='True')
                   {
                        progressbar.progressbar({
                             value: true,
                        });
                      progressLabel.text("成功:"+obj['data']);
                   }
                   else
                   {
                     progressbar.progressbar({
                             value: true,
                        });
                      progressLabel.text("读取失败,重试一下吧！");
                   }

              },
              //请求出错的处理
              error:function(){
                 progressbar.progressbar({
                             value: true,
                        });
                 progressLabel.text("出错了，请重试....！");;
              }
           });
     }

     if (p == 'save')
     {
         $.ajax({
               type:"post",//请求方式
               url:"/post/save/wifi",//发送请求地址
               timeout:20000,//超时时间：20秒
               data:json_data,
               dataType:"html",//设置返回数据的格式
               //请求成功后的回调函数 data为html格式
               success:function(res){
                   alert('success'+res);
                   obj = JSON.parse(res);
                   //JSON.stringify(); //JavaScript 值转换为 JSON 字符串
                   if (obj['connected']=='True')
                   {
                        progressbar.progressbar({
                             value: true,
                        });
                      progressLabel.text("保存成功！");
                   }
                   else
                   {
                     progressbar.progressbar({
                             value: true,
                        });
                      progressLabel.text("保存失败,重试一下吧！");
                   }

              },
              //请求出错的处理
              error:function(){
                 progressbar.progressbar({
                             value: true,
                        });
                 progressLabel.text("出错了，请重试....！");;
              }
           });
     }

}

</script>

</body>

</html>
